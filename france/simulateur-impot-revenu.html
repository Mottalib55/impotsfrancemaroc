<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Impot sur le Revenu 2025 | NetSalaire</title>
    <meta name="description" content="Simulateur impots 2025 gratuit et instantane. Calculez votre impot sur le revenu, simulez l'economie avec le PER. Baremes officiels.">
    <link rel="canonical" href="https://netsalaire.com/france/simulateur-impot-revenu.html">
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Navigation CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        },
                        emerald: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Range slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px; width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #0ea5e9;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: linear-gradient(to right, #0ea5e9 0%, #0ea5e9 var(--progress, 0%), #e2e8f0 var(--progress, 0%), #e2e8f0 100%);
            border-radius: 9999px;
        }

        /* Animations */
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-transition { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Hide number spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* Tooltip */
        .tooltip { position: relative; }
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 50;
            margin-bottom: 6px;
        }

        /* Mobile sticky */
        @media (max-width: 1023px) {
            .mobile-sticky-btn {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 40;
            }
        }

        /* Hide details marker */
        details summary { list-style: none; }
        details summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-600 antialiased selection:bg-brand-100">

    <!-- Navigation NetSalaire -->
    <nav class="nav-container">
        <div class="nav-inner">
            <a href="/" class="nav-logo">
                <img src="/assets/images/logo.svg" alt="NetSalaire" height="32">
            </a>
            <button class="nav-toggle" onclick="document.querySelector('.nav-menu').classList.toggle('active')">
                <i data-lucide="menu" class="h-6 w-6"></i>
            </button>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/comparateur-salaire-france-maroc.html" class="nav-link">
                        <i data-lucide="scale" class="h-4 w-4"></i> Comparateur
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i data-lucide="flag" class="h-4 w-4"></i> France <i data-lucide="chevron-down" class="h-4 w-4"></i>
                    </a>
                    <ul class="nav-dropdown">
                        <li><a href="/france/simulateur-salaire-brut-net.html">Brut vers Net</a></li>
                        <li><a href="/france/simulateur-impot-revenu.html">Simulateur IR</a></li>
                        <li><a href="/france/guide/">Guide Fiscal</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i data-lucide="flag" class="h-4 w-4"></i> Maroc <i data-lucide="chevron-down" class="h-4 w-4"></i>
                    </a>
                    <ul class="nav-dropdown">
                        <li><a href="/maroc/simulateur-salaire-brut-net.html">Brut vers Net</a></li>
                        <li><a href="/maroc/simulateur-ir.html">Simulateur IR</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a href="/faq.html" class="nav-link">
                        <i data-lucide="help-circle" class="h-4 w-4"></i> FAQ
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <main class="flex-grow">
        <!-- Hero Section -->
        <section class="pt-12 pb-6 md:pt-20 md:pb-10 text-center px-4">
            <div class="inline-flex items-center gap-2 rounded-full bg-emerald-50 border border-emerald-200 px-4 py-1.5 mb-6">
                <i data-lucide="sparkles" class="h-4 w-4 text-emerald-600"></i>
                <span class="text-sm font-medium text-emerald-700">Bareme 2025 - 100% Gratuit - Resultat instantane</span>
            </div>
            <h1 class="mx-auto max-w-4xl text-3xl font-bold tracking-tight text-slate-900 sm:text-5xl lg:text-6xl">
                <span class="text-brand-600">Simulateur Impots</span> 2025
            </h1>
            <p class="mx-auto mt-6 max-w-2xl text-lg text-slate-500">
                Simulation impots gratuite et instantanee. Calculez votre impot sur le revenu et decouvrez combien vous pouvez economiser grace au <strong class="text-slate-700">PER</strong> et aux <strong class="text-slate-700">dons</strong>.
            </p>
        </section>

        <!-- Simulator Container -->
        <div id="simulateur" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-20">
            <div class="grid grid-cols-1 gap-5 lg:grid-cols-12 items-start">

                <!-- Card: Situation -->
                <div class="order-1 lg:col-span-7 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-brand-50 rounded-lg text-brand-600">
                                <i data-lucide="users" class="h-5 w-5"></i>
                            </div>
                            <h2 class="text-lg font-semibold text-slate-900">Votre situation</h2>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-slate-400">Parts fiscales</span>
                            <p class="text-lg font-bold text-brand-600" id="display-parts">1</p>
                        </div>
                    </div>

                    <!-- Statut Marital -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-3">Statut marital</label>
                        <div class="grid grid-cols-3 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="status" value="single" class="peer sr-only" checked>
                                <div class="rounded-xl border-2 border-slate-200 bg-white p-3 text-center hover:border-slate-300 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all">
                                    <i data-lucide="user" class="h-5 w-5 mx-auto mb-1 text-slate-400"></i>
                                    <span class="block text-sm font-medium text-slate-700">Celibataire</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="status" value="married" class="peer sr-only">
                                <div class="rounded-xl border-2 border-slate-200 bg-white p-3 text-center hover:border-slate-300 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all">
                                    <i data-lucide="heart" class="h-5 w-5 mx-auto mb-1 text-slate-400"></i>
                                    <span class="block text-sm font-medium text-slate-700">Marie/PACS</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="status" value="divorced" class="peer sr-only">
                                <div class="rounded-xl border-2 border-slate-200 bg-white p-3 text-center hover:border-slate-300 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all">
                                    <i data-lucide="user-x" class="h-5 w-5 mx-auto mb-1 text-slate-400"></i>
                                    <span class="block text-sm font-medium text-slate-700">Divorce(e)</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Enfants -->
                    <div class="mb-5 flex items-center justify-between">
                        <div>
                            <label class="block text-sm font-medium text-slate-700">Enfants a charge</label>
                            <p class="text-xs text-slate-400 mt-0.5">Mineurs ou rattaches au foyer</p>
                        </div>
                        <div class="flex items-center gap-3 rounded-lg border border-slate-200 bg-slate-50 p-1">
                            <button id="btn-child-minus" type="button" class="h-9 w-9 rounded-md bg-white text-slate-500 shadow-sm hover:text-brand-600 hover:bg-slate-50 flex items-center justify-center transition-all active:scale-95">
                                <i data-lucide="minus" class="h-4 w-4"></i>
                            </button>
                            <span id="child-count" class="w-8 text-center text-xl font-bold text-slate-900">0</span>
                            <button id="btn-child-plus" type="button" class="h-9 w-9 rounded-md bg-white text-slate-500 shadow-sm hover:text-brand-600 hover:bg-slate-50 flex items-center justify-center transition-all active:scale-95">
                                <i data-lucide="plus" class="h-4 w-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Parent Isole -->
                    <div id="parent-isole-container" class="flex items-center justify-between border-t border-slate-100 pt-4">
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium text-slate-700">Parent isole</label>
                            <span class="tooltip cursor-help" data-tip="Vous elevez seul(e) vos enfants">
                                <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                            </span>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="parent-isole" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-brand-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                        </label>
                    </div>
                </div>

                <!-- Card: Revenus -->
                <div class="order-2 lg:col-span-7 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-brand-50 rounded-lg text-brand-600">
                            <i data-lucide="wallet" class="h-5 w-5"></i>
                        </div>
                        <h2 class="text-lg font-semibold text-slate-900">Vos revenus annuels</h2>
                    </div>

                    <!-- Revenu Principal -->
                    <div class="mb-5">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-sm font-medium text-slate-700">
                                Revenu net imposable
                                <span class="text-slate-400 font-normal" id="label-declarant1">(vous)</span>
                            </label>
                            <div class="relative">
                                <input type="number" id="income1-input" value="40000" min="0" max="500000" class="block w-36 text-right rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-brand-500 text-sm font-semibold transition-all">
                                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                            </div>
                        </div>
                        <input type="range" id="income1-slider" min="0" max="200000" step="500" value="40000" class="w-full h-2 rounded-lg cursor-pointer">
                        <div class="flex justify-between mt-1">
                            <span class="text-xs text-slate-400">0 EUR</span>
                            <span class="text-xs text-slate-400">200 000 EUR+</span>
                        </div>
                    </div>

                    <!-- Toggle 2 revenus -->
                    <div id="two-incomes-toggle" class="hidden mb-5 flex items-center justify-between border-t border-slate-100 pt-4">
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium text-slate-700">Deux revenus dans le foyer</label>
                            <span class="tooltip cursor-help" data-tip="Activez si votre conjoint a aussi des revenus">
                                <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                            </span>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="has-two-incomes" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-brand-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                        </label>
                    </div>

                    <!-- Revenu Conjoint -->
                    <div id="income2-container" class="hidden mb-5 animate-in">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-sm font-medium text-slate-700">Revenu net imposable <span class="text-slate-400 font-normal">(conjoint)</span></label>
                            <div class="relative">
                                <input type="number" id="income2-input" value="0" min="0" max="500000" class="block w-36 text-right rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-brand-500 text-sm font-semibold transition-all">
                                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                            </div>
                        </div>
                        <input type="range" id="income2-slider" min="0" max="200000" step="500" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                    </div>

                    <!-- Autres revenus -->
                    <details class="border-t border-slate-100 pt-4 group">
                        <summary class="flex cursor-pointer items-center justify-between text-sm font-medium text-brand-600 hover:text-brand-700">
                            <span class="flex items-center gap-2">
                                <i data-lucide="plus-circle" class="h-4 w-4"></i>
                                Autres revenus (fonciers, etc.)
                            </span>
                            <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                        </summary>
                        <div class="mt-4 space-y-4 animate-in">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-2">Revenus fonciers nets</label>
                                <div class="relative">
                                    <input type="number" id="income-foncier" value="0" min="0" class="block w-full rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-brand-500 text-sm transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- Card: PER -->
                <div class="order-4 lg:col-span-7 rounded-2xl border-2 border-emerald-200 bg-gradient-to-br from-emerald-50 to-white p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                                <i data-lucide="piggy-bank" class="h-5 w-5"></i>
                            </div>
                            <div>
                                <h2 class="text-lg font-semibold text-slate-900">Plan d'Epargne Retraite (PER)</h2>
                                <p class="text-xs text-slate-500">Deduisez vos versements de votre revenu imposable</p>
                            </div>
                        </div>
                        <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-1 text-xs font-medium text-emerald-700">
                            Optimisation
                        </span>
                    </div>

                    <!-- Toggle PER -->
                    <div class="flex items-center justify-between mb-5">
                        <label class="text-sm font-medium text-slate-700">As-tu verse sur un PER cette annee ?</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="has-per" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                        </label>
                    </div>

                    <!-- PER Details -->
                    <div id="per-details" class="hidden space-y-4 animate-in">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-slate-700">Montant verse sur le PER</label>
                                <div class="relative">
                                    <input type="number" id="per-amount" value="0" min="0" class="block w-36 text-right rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 text-sm font-semibold transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                                </div>
                            </div>
                            <input type="range" id="per-slider" min="0" max="30000" step="100" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                            <div class="flex justify-between mt-1">
                                <span class="text-xs text-slate-400">0 EUR</span>
                                <span class="text-xs text-slate-400">30 000 EUR</span>
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="per-plafond-unknown" class="rounded border-slate-300 text-emerald-600 focus:ring-emerald-500">
                            <label for="per-plafond-unknown" class="text-sm text-slate-600">Je ne connais pas mon plafond de deduction</label>
                        </div>

                        <div id="per-plafond-container">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <label class="text-sm font-medium text-slate-700">Plafond de deduction disponible</label>
                                    <span class="tooltip cursor-help" data-tip="Visible sur votre dernier avis d'imposition">
                                        <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                    </span>
                                </div>
                                <div class="relative">
                                    <input type="number" id="per-plafond" value="0" min="0" class="block w-36 text-right rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 text-sm font-semibold transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                                </div>
                            </div>
                        </div>

                        <!-- PER Summary -->
                        <div class="rounded-xl bg-white border border-emerald-200 p-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Deduction retenue</span>
                                <span class="text-sm font-bold text-emerald-600" id="per-deduction-display">0 EUR</span>
                            </div>
                            <div class="flex justify-between items-center mt-2 pt-2 border-t border-slate-100">
                                <span class="text-sm text-slate-600">Revenu imposable apres PER</span>
                                <span class="text-sm font-bold text-slate-900" id="income-after-per-display">0 EUR</span>
                            </div>
                        </div>

                        <div id="per-warning" class="hidden rounded-lg bg-amber-50 border border-amber-200 p-3 text-sm text-amber-800">
                            <div class="flex gap-2">
                                <i data-lucide="alert-triangle" class="h-4 w-4 text-amber-500 flex-shrink-0 mt-0.5"></i>
                                <span>Plafond non renseigne : la deduction est estimee au montant verse.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card: Dons -->
                <div class="order-5 lg:col-span-7 rounded-2xl border-2 border-violet-200 bg-gradient-to-br from-violet-50 to-white p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-violet-100 rounded-lg text-violet-600">
                                <i data-lucide="heart-handshake" class="h-5 w-5"></i>
                            </div>
                            <div>
                                <h2 class="text-lg font-semibold text-slate-900">Dons & Reductions d'impot</h2>
                                <p class="text-xs text-slate-500">Reduisez directement votre impot (66% a 75%)</p>
                            </div>
                        </div>
                        <span class="inline-flex items-center rounded-full bg-violet-100 px-2.5 py-1 text-xs font-medium text-violet-700">
                            Reduction
                        </span>
                    </div>

                    <!-- Toggle Dons -->
                    <div class="flex items-center justify-between mb-5">
                        <label class="text-sm font-medium text-slate-700">As-tu fait des dons cette annee ?</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="has-dons" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-violet-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                        </label>
                    </div>

                    <!-- Dons Details -->
                    <div id="dons-details" class="hidden space-y-4 animate-in">
                        <!-- Dons 66% -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <label class="text-sm font-medium text-slate-700">Dons associations (66%)</label>
                                    <span class="tooltip cursor-help" data-tip="Associations d'interet general, fondations...">
                                        <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                    </span>
                                </div>
                                <div class="relative">
                                    <input type="number" id="dons-66" value="0" min="0" class="block w-36 text-right rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-violet-500 text-sm font-semibold transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                                </div>
                            </div>
                            <input type="range" id="dons-66-slider" min="0" max="10000" step="50" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                        </div>

                        <!-- Dons 75% -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <label class="text-sm font-medium text-slate-700">Dons aide aux personnes (75%)</label>
                                    <span class="tooltip cursor-help" data-tip="Restos du Coeur, Secours Populaire... (plafonne a 1000EUR)">
                                        <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                    </span>
                                </div>
                                <div class="relative">
                                    <input type="number" id="dons-75" value="0" min="0" class="block w-36 text-right rounded-lg border-0 py-2 pl-3 pr-12 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-violet-500 text-sm font-semibold transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs">EUR</span>
                                </div>
                            </div>
                            <input type="range" id="dons-75-slider" min="0" max="2000" step="50" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                            <p class="text-xs text-slate-400 mt-1">75% jusqu'a 1000EUR, puis 66% au-dela</p>
                        </div>

                        <!-- Dons Summary -->
                        <div class="rounded-xl bg-white border border-violet-200 p-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Total des dons</span>
                                <span class="text-sm font-bold text-slate-900" id="dons-total-display">0 EUR</span>
                            </div>
                            <div class="flex justify-between items-center mt-2 pt-2 border-t border-slate-100">
                                <span class="text-sm text-slate-600">Reduction d'impot</span>
                                <span class="text-sm font-bold text-violet-600" id="dons-reduction-display">0 EUR</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="order-6 lg:col-span-7 flex items-center justify-between pt-2">
                    <button id="btn-reset" type="button" class="text-sm text-slate-500 hover:text-slate-900 flex items-center gap-1.5 transition-colors">
                        <i data-lucide="rotate-ccw" class="h-4 w-4"></i> Reinitialiser
                    </button>
                    <span class="text-xs text-slate-400">Bareme 2025 - Mis a jour janvier 2025</span>
                </div>

                <!-- Results Column -->
                <div class="order-3 lg:col-span-5 lg:row-span-6 lg:row-start-1 lg:col-start-8 relative">
                    <div class="lg:sticky lg:top-24 space-y-5">

                        <!-- Main Result Card -->
                        <div class="rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 text-white p-6 shadow-xl overflow-hidden relative">
                            <div class="absolute top-0 right-0 -mt-8 -mr-8 h-32 w-32 rounded-full bg-brand-500 opacity-20 blur-2xl"></div>
                            <div class="absolute bottom-0 left-0 -mb-8 -ml-8 h-24 w-24 rounded-full bg-emerald-500 opacity-10 blur-xl"></div>

                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-400 uppercase tracking-wider">Estimation impot 2025</h3>
                                <span class="inline-flex items-center rounded-full bg-white/10 px-2.5 py-1 text-xs font-medium text-white/80">
                                    <i data-lucide="zap" class="h-3 w-3 mr-1"></i> Temps reel
                                </span>
                            </div>

                            <div class="flex items-end gap-2 mb-1">
                                <span class="text-5xl font-bold tracking-tight" id="result-tax">0 EUR</span>
                            </div>
                            <p class="text-sm text-slate-400 mb-4">Impot sur le revenu estime</p>

                            <div class="h-1.5 w-full bg-slate-700 rounded-full mb-6 overflow-hidden">
                                <div id="tax-progress-bar" class="h-full bg-gradient-to-r from-brand-400 to-brand-500 chart-transition rounded-full" style="width: 0%"></div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 border-t border-slate-700/50 pt-4">
                                <div>
                                    <p class="text-xs text-slate-400 mb-1">Taux moyen</p>
                                    <p class="text-2xl font-bold text-brand-400" id="result-avg-rate">0%</p>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 mb-1">Taux marginal</p>
                                    <p class="text-2xl font-bold text-white" id="result-marginal-rate">0%</p>
                                </div>
                            </div>
                        </div>

                        <!-- Savings Cards -->
                        <div class="space-y-3">
                            <!-- PER Savings -->
                            <div id="per-savings-card" class="hidden rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 text-white p-5 shadow-lg animate-in">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-emerald-100 mb-1">Economie grace au PER</p>
                                        <p class="text-3xl font-bold" id="result-per-savings">0 EUR</p>
                                    </div>
                                    <div class="h-14 w-14 rounded-full bg-white/20 flex items-center justify-center">
                                        <i data-lucide="piggy-bank" class="h-7 w-7"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-emerald-100 mt-3">
                                    Chaque EUR verse reduit votre impot de <span id="per-efficiency">0</span> centimes.
                                </p>
                            </div>

                            <!-- Dons Savings -->
                            <div id="dons-savings-card" class="hidden rounded-2xl bg-gradient-to-br from-violet-500 to-violet-600 text-white p-5 shadow-lg animate-in">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-violet-100 mb-1">Reduction grace aux dons</p>
                                        <p class="text-3xl font-bold" id="result-dons-savings">0 EUR</p>
                                    </div>
                                    <div class="h-14 w-14 rounded-full bg-white/20 flex items-center justify-center">
                                        <i data-lucide="heart" class="h-7 w-7"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-violet-100 mt-3">
                                    Vos dons de <span id="dons-total-result">0 EUR</span> reduisent directement votre impot.
                                </p>
                            </div>
                        </div>

                        <!-- Net Result Card -->
                        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
                            <h3 class="text-sm font-semibold text-slate-900 mb-4">Votre reste a vivre</h3>

                            <div class="flex items-center gap-6 mb-6">
                                <!-- Donut Chart -->
                                <div class="relative h-28 w-28 flex-shrink-0">
                                    <div id="chart-donut" class="absolute inset-0 rounded-full chart-transition" style="background: conic-gradient(#0ea5e9 0% 10%, #f1f5f9 10% 100%);"></div>
                                    <div class="absolute inset-3 rounded-full bg-white flex items-center justify-center flex-col shadow-inner">
                                        <span class="text-xs text-slate-400">Net</span>
                                        <span id="chart-percent" class="text-lg font-bold text-slate-900">90%</span>
                                    </div>
                                </div>

                                <div class="flex-grow space-y-3">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            <span class="h-3 w-3 rounded-full bg-slate-200"></span>
                                            <span class="text-sm text-slate-600">Revenu net annuel</span>
                                        </div>
                                        <span class="text-sm font-semibold text-slate-900" id="result-net-annual">0 EUR</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            <span class="h-3 w-3 rounded-full bg-brand-500"></span>
                                            <span class="text-sm text-slate-600">Impot</span>
                                        </div>
                                        <span class="text-sm font-medium text-slate-500" id="result-tax-small">- 0 EUR</span>
                                    </div>
                                    <div class="pt-2 border-t border-slate-100">
                                        <div class="flex justify-between items-baseline">
                                            <span class="text-sm font-medium text-slate-900">Mensuel net</span>
                                            <span class="text-xl font-bold text-brand-600" id="result-monthly">0 EUR</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Calculation Details -->
                            <details class="group">
                                <summary class="flex cursor-pointer items-center justify-between rounded-lg bg-slate-50 p-3 text-sm font-medium text-slate-700 hover:bg-slate-100 transition-colors">
                                    <span class="flex items-center gap-2">
                                        <i data-lucide="file-text" class="h-4 w-4"></i>
                                        Details du calcul
                                    </span>
                                    <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                                </summary>
                                <div class="mt-3 px-1 text-sm text-slate-600 space-y-2" id="calc-details">
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Revenu brut du foyer</span>
                                        <span class="font-medium text-slate-900" id="detail-gross">0 EUR</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Abattement 10%</span>
                                        <span class="font-medium text-slate-900" id="detail-abattement">- 0 EUR</span>
                                    </div>
                                    <div id="detail-per-row" class="hidden flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Deduction PER</span>
                                        <span class="font-medium text-emerald-600" id="detail-per">- 0 EUR</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Revenu imposable</span>
                                        <span class="font-medium text-slate-900" id="detail-taxable">0 EUR</span>
                                    </div>
                                    <div id="detail-dons-row" class="hidden flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Reduction dons</span>
                                        <span class="font-medium text-violet-600" id="detail-dons">- 0 EUR</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Nombre de parts</span>
                                        <span class="font-medium text-slate-900" id="detail-parts">1</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Quotient familial</span>
                                        <span class="font-medium text-slate-900" id="detail-qf">0 EUR</span>
                                    </div>
                                    <div class="mt-3 p-3 bg-slate-50 rounded-lg overflow-x-auto">
                                        <p class="text-xs font-medium text-slate-700 mb-3">Tranches appliquees (par part) :</p>
                                        <table class="w-full text-xs">
                                            <thead>
                                                <tr class="text-left text-slate-500 border-b border-slate-200">
                                                    <th class="pb-2 font-medium">Tranche</th>
                                                    <th class="pb-2 font-medium text-right">Montant</th>
                                                    <th class="pb-2 font-medium text-right">Taux</th>
                                                    <th class="pb-2 font-medium text-right">Impot</th>
                                                </tr>
                                            </thead>
                                            <tbody id="detail-tranches" class="text-slate-600"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </details>
                        </div>

                        <!-- Tips Card -->
                        <div class="rounded-xl bg-gradient-to-br from-indigo-50 to-white border border-indigo-100 p-4">
                            <div class="flex gap-3">
                                <div class="text-indigo-600 mt-0.5"><i data-lucide="lightbulb" class="h-5 w-5"></i></div>
                                <div>
                                    <h4 class="text-sm font-semibold text-indigo-900">Conseil personnalise</h4>
                                    <p class="text-sm text-indigo-700 mt-1 leading-relaxed" id="dynamic-tip">
                                        Analysez votre situation pour obtenir un conseil adapte.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Disclaimer -->
                        <div class="text-center text-xs text-slate-400 px-4">
                            <i data-lucide="info" class="h-3 w-3 inline mr-1"></i>
                            Estimation indicative basee sur le bareme officiel. Ne remplace pas l'avis de l'administration fiscale.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Sticky Button -->
    <button id="mobile-results-btn" class="lg:hidden mobile-sticky-btn inline-flex items-center gap-2 rounded-full bg-brand-600 px-6 py-3 text-sm font-semibold text-white shadow-lg hover:bg-brand-700 transition-all">
        <i data-lucide="calculator" class="h-4 w-4"></i>
        Voir mes resultats
    </button>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <div class="footer-grid">
                <div>
                    <h4>NetSalaire</h4>
                    <p>Simulateurs fiscaux gratuits pour la France et le Maroc. Comparez, simulez, optimisez.</p>
                </div>
                <div>
                    <h4>France</h4>
                    <ul>
                        <li><a href="/france/simulateur-salaire-brut-net.html">Brut vers Net</a></li>
                        <li><a href="/france/simulateur-impot-revenu.html">Simulateur IR</a></li>
                        <li><a href="/france/guide/">Guide Fiscal</a></li>
                    </ul>
                </div>
                <div>
                    <h4>Maroc</h4>
                    <ul>
                        <li><a href="/maroc/simulateur-salaire-brut-net.html">Brut vers Net</a></li>
                        <li><a href="/maroc/simulateur-ir.html">Simulateur IR</a></li>
                    </ul>
                </div>
                <div>
                    <h4>Informations</h4>
                    <ul>
                        <li><a href="/faq.html">FAQ</a></li>
                        <li><a href="/mentions-legales.html">Mentions Legales</a></li>
                        <li><a href="/politique-confidentialite.html">Confidentialite</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 NetSalaire.com - Estimation indicative, ne remplace pas l'avis de l'administration fiscale</p>
            </div>
        </div>
    </footer>

    <!-- Calculator Script -->
    <script>
    (function() {
        'use strict';

        const TAX_BRACKETS = [
            { limit: 11497, rate: 0 },
            { limit: 29315, rate: 0.11 },
            { limit: 83823, rate: 0.30 },
            { limit: 180294, rate: 0.41 },
            { limit: Infinity, rate: 0.45 }
        ];

        const ABATTEMENT_RATE = 0.10;
        const ABATTEMENT_MAX = 14171;
        const ABATTEMENT_MIN = 495;

        const state = {
            status: 'single',
            children: 0,
            parentIsole: false,
            income1: 40000,
            income2: 0,
            hasTwoIncomes: false,
            incomeFoncier: 0,
            hasPer: false,
            perAmount: 0,
            perPlafond: 0,
            perPlafondUnknown: false,
            hasDons: false,
            dons66: 0,
            dons75: 0
        };

        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => document.querySelectorAll(sel);

        const formatMoney = (val) => Math.round(val).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ') + ' EUR';
        const formatPercent = (val) => val.toFixed(1) + '%';
        const clamp = (val, min, max) => Math.min(Math.max(val, min), max);

        function calculateParts() {
            let parts = state.status === 'married' ? 2 : 1;
            if (state.children >= 1) parts += 0.5;
            if (state.children >= 2) parts += 0.5;
            if (state.children >= 3) parts += (state.children - 2);
            if (state.parentIsole && state.children > 0 && state.status !== 'married') {
                parts += 0.5;
            }
            return parts;
        }

        function calculateAbattement(income) {
            const abattement = income * ABATTEMENT_RATE;
            return clamp(abattement, income > 0 ? ABATTEMENT_MIN : 0, ABATTEMENT_MAX);
        }

        function calculateTax(taxableIncome, parts) {
            const qf = taxableIncome / parts;
            let taxPerPart = 0;
            let marginalRate = 0;
            const tranchesApplied = [];

            for (let i = 0; i < TAX_BRACKETS.length; i++) {
                const bracket = TAX_BRACKETS[i];
                const prevLimit = i === 0 ? 0 : TAX_BRACKETS[i - 1].limit;
                let amountInBracket = 0;
                let taxInBracket = 0;

                if (qf > prevLimit) {
                    amountInBracket = Math.min(qf, bracket.limit) - prevLimit;
                    taxInBracket = amountInBracket * bracket.rate;
                    taxPerPart += taxInBracket;
                    marginalRate = bracket.rate;
                }

                tranchesApplied.push({
                    from: prevLimit,
                    to: bracket.limit,
                    rate: bracket.rate,
                    amount: amountInBracket,
                    tax: taxInBracket
                });
            }

            return { tax: Math.floor(taxPerPart * parts), marginalRate, qf, tranchesApplied };
        }

        function calculate() {
            const parts = calculateParts();
            let grossIncome = state.income1 + state.incomeFoncier;
            if (state.status === 'married' && state.hasTwoIncomes) {
                grossIncome += state.income2;
            }

            let totalAbattement = calculateAbattement(state.income1);
            if (state.status === 'married' && state.hasTwoIncomes) {
                totalAbattement += calculateAbattement(state.income2);
            }

            let perDeduction = 0;
            if (state.hasPer && state.perAmount > 0) {
                if (state.perPlafondUnknown || state.perPlafond === 0) {
                    perDeduction = state.perAmount;
                } else {
                    perDeduction = Math.min(state.perAmount, state.perPlafond);
                }
            }

            const incomeAfterAbattement = Math.max(0, grossIncome - totalAbattement);
            const taxableIncome = Math.max(0, incomeAfterAbattement - perDeduction);
            const result = calculateTax(taxableIncome, parts);
            const resultWithoutPer = calculateTax(incomeAfterAbattement, parts);
            const perSavings = resultWithoutPer.tax - result.tax;

            let donsReduction = 0;
            let donsTotal = 0;
            if (state.hasDons) {
                donsTotal = state.dons66 + state.dons75;
                const dons75Capped = Math.min(state.dons75, 1000);
                const dons75Excess = Math.max(0, state.dons75 - 1000);
                donsReduction = Math.floor((state.dons66 * 0.66) + (dons75Capped * 0.75) + (dons75Excess * 0.66));
                const maxDonsReduction = Math.floor(taxableIncome * 0.20);
                donsReduction = Math.min(donsReduction, maxDonsReduction);
            }

            const finalTax = Math.max(0, result.tax - donsReduction);
            const netAfterTax = grossIncome - finalTax;
            const monthly = netAfterTax / 12;
            const avgRate = grossIncome > 0 ? (finalTax / grossIncome) * 100 : 0;
            const taxPercent = grossIncome > 0 ? (finalTax / grossIncome) * 100 : 0;

            updateUI({
                parts, grossIncome, totalAbattement, perDeduction, incomeAfterAbattement, taxableIncome,
                tax: finalTax, taxBeforeDons: result.tax, marginalRate: result.marginalRate, qf: result.qf,
                tranchesApplied: result.tranchesApplied, netAfterTax, monthly, avgRate, taxPercent, perSavings, donsTotal, donsReduction
            });
            updateURL();
        }

        function updateUI(data) {
            $('#display-parts').textContent = data.parts;

            if (state.hasPer) {
                $('#per-deduction-display').textContent = formatMoney(data.perDeduction);
                $('#income-after-per-display').textContent = formatMoney(data.taxableIncome);
                if (state.perPlafondUnknown || state.perPlafond === 0) {
                    $('#per-warning').classList.remove('hidden');
                } else {
                    $('#per-warning').classList.add('hidden');
                }
            }

            $('#result-tax').textContent = formatMoney(data.tax);
            $('#result-avg-rate').textContent = formatPercent(data.avgRate);
            $('#result-marginal-rate').textContent = (data.marginalRate * 100).toFixed(0) + '%';
            $('#tax-progress-bar').style.width = Math.min(data.avgRate * 2.5, 100) + '%';

            if (state.hasPer && data.perSavings > 0) {
                $('#per-savings-card').classList.remove('hidden');
                $('#result-per-savings').textContent = formatMoney(data.perSavings);
                const efficiency = data.perDeduction > 0 ? Math.round((data.perSavings / data.perDeduction) * 100) : 0;
                $('#per-efficiency').textContent = efficiency;
            } else {
                $('#per-savings-card').classList.add('hidden');
            }

            if (state.hasDons && data.donsReduction > 0) {
                $('#dons-savings-card').classList.remove('hidden');
                $('#result-dons-savings').textContent = formatMoney(data.donsReduction);
                $('#dons-total-result').textContent = formatMoney(data.donsTotal);
            } else {
                $('#dons-savings-card').classList.add('hidden');
            }

            if (state.hasDons) {
                $('#dons-total-display').textContent = formatMoney(data.donsTotal);
                $('#dons-reduction-display').textContent = formatMoney(data.donsReduction);
            }

            $('#chart-percent').textContent = (100 - data.taxPercent).toFixed(0) + '%';
            $('#chart-donut').style.background = `conic-gradient(#0ea5e9 0% ${data.taxPercent}%, #f1f5f9 ${data.taxPercent}% 100%)`;
            $('#result-net-annual').textContent = formatMoney(data.netAfterTax);
            $('#result-tax-small').textContent = '- ' + formatMoney(data.tax);
            $('#result-monthly').textContent = formatMoney(data.monthly);

            $('#detail-gross').textContent = formatMoney(data.grossIncome);
            $('#detail-abattement').textContent = '- ' + formatMoney(data.totalAbattement);

            if (state.hasPer && data.perDeduction > 0) {
                $('#detail-per-row').classList.remove('hidden');
                $('#detail-per').textContent = '- ' + formatMoney(data.perDeduction);
            } else {
                $('#detail-per-row').classList.add('hidden');
            }

            $('#detail-taxable').textContent = formatMoney(data.taxableIncome);

            if (state.hasDons && data.donsReduction > 0) {
                $('#detail-dons-row').classList.remove('hidden');
                $('#detail-dons').textContent = '- ' + formatMoney(data.donsReduction);
            } else {
                $('#detail-dons-row').classList.add('hidden');
            }

            $('#detail-parts').textContent = data.parts;
            $('#detail-qf').textContent = formatMoney(data.qf);

            $('#detail-tranches').innerHTML = data.tranchesApplied.map((t, i) => {
                const isActive = t.amount > 0;
                const rowClass = isActive ? 'text-slate-900 font-medium' : 'text-slate-400';
                const bgClass = isActive ? 'bg-brand-50/50' : '';
                let trancheLabel;
                if (i === 0) trancheLabel = `Jusqu'a ${formatMoney(t.to)}`;
                else if (t.to === Infinity) trancheLabel = `Au-dela de ${formatMoney(t.from)}`;
                else trancheLabel = `${formatMoney(t.from + 1)} - ${formatMoney(t.to)}`;
                return `<tr class="${bgClass}"><td class="py-1.5 pr-2 ${rowClass}">${trancheLabel}</td><td class="py-1.5 text-right ${rowClass}">${formatMoney(t.amount)}</td><td class="py-1.5 text-right ${rowClass}">${(t.rate * 100).toFixed(0)}%</td><td class="py-1.5 text-right ${isActive ? 'text-brand-600 font-semibold' : 'text-slate-400'}">${formatMoney(t.tax)}</td></tr>`;
            }).join('') + `<tr class="border-t border-slate-200 font-semibold text-slate-900"><td class="pt-2">Total x ${data.parts} parts</td><td></td><td></td><td class="pt-2 text-right text-brand-600">${formatMoney(data.taxBeforeDons)}</td></tr>`;

            updateTip(data);
        }

        function updateTip(data) {
            let tip = '';
            if (data.tax === 0) {
                tip = "Vous n'etes pas imposable. Pensez a epargner via un Livret A ou LEP.";
            } else if (!state.hasPer && data.marginalRate >= 0.30) {
                tip = `Avec un taux marginal de ${(data.marginalRate * 100).toFixed(0)}%, le PER serait tres efficace. Chaque EUR verse vous ferait economiser ${(data.marginalRate * 100).toFixed(0)} centimes d'impot.`;
            } else if (state.hasPer && data.perSavings > 0) {
                tip = `Excellent ! Votre PER vous fait economiser ${formatMoney(data.perSavings)} d'impot.`;
            } else {
                tip = "Pensez aux deductions (PER, dons) pour reduire votre impot.";
            }
            $('#dynamic-tip').textContent = tip;
        }

        function updateURL() {
            const params = new URLSearchParams();
            params.set('status', state.status);
            params.set('children', state.children);
            if (state.parentIsole) params.set('isole', '1');
            params.set('income1', state.income1);
            if (state.status === 'married' && state.hasTwoIncomes) params.set('income2', state.income2);
            if (state.incomeFoncier > 0) params.set('foncier', state.incomeFoncier);
            if (state.hasPer) {
                params.set('per', state.perAmount);
                if (!state.perPlafondUnknown && state.perPlafond > 0) params.set('plafond', state.perPlafond);
            }
            if (state.hasDons) {
                if (state.dons66 > 0) params.set('dons66', state.dons66);
                if (state.dons75 > 0) params.set('dons75', state.dons75);
            }
            history.replaceState(null, '', window.location.pathname + '?' + params.toString());
        }

        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('status')) { state.status = params.get('status'); const r = $(`input[name="status"][value="${state.status}"]`); if (r) r.checked = true; }
            if (params.has('children')) { state.children = parseInt(params.get('children')) || 0; $('#child-count').textContent = state.children; }
            if (params.has('isole')) { state.parentIsole = params.get('isole') === '1'; $('#parent-isole').checked = state.parentIsole; }
            if (params.has('income1')) { state.income1 = parseInt(params.get('income1')) || 40000; $('#income1-input').value = state.income1; $('#income1-slider').value = Math.min(state.income1, 200000); }
            if (params.has('income2')) { state.income2 = parseInt(params.get('income2')) || 0; state.hasTwoIncomes = true; $('#has-two-incomes').checked = true; $('#income2-input').value = state.income2; $('#income2-slider').value = Math.min(state.income2, 200000); }
            if (params.has('foncier')) { state.incomeFoncier = parseInt(params.get('foncier')) || 0; $('#income-foncier').value = state.incomeFoncier; }
            if (params.has('per')) { state.hasPer = true; state.perAmount = parseInt(params.get('per')) || 0; $('#has-per').checked = true; $('#per-amount').value = state.perAmount; $('#per-slider').value = Math.min(state.perAmount, 30000); $('#per-details').classList.remove('hidden'); if (params.has('plafond')) { state.perPlafond = parseInt(params.get('plafond')) || 0; $('#per-plafond').value = state.perPlafond; } }
            if (params.has('dons66') || params.has('dons75')) { state.hasDons = true; $('#has-dons').checked = true; $('#dons-details').classList.remove('hidden'); if (params.has('dons66')) { state.dons66 = parseInt(params.get('dons66')) || 0; $('#dons-66').value = state.dons66; $('#dons-66-slider').value = Math.min(state.dons66, 10000); } if (params.has('dons75')) { state.dons75 = parseInt(params.get('dons75')) || 0; $('#dons-75').value = state.dons75; $('#dons-75-slider').value = Math.min(state.dons75, 2000); } }
            updateVisibility();
        }

        function updateVisibility() {
            if (state.status === 'married') { $('#two-incomes-toggle').classList.remove('hidden'); $('#two-incomes-toggle').classList.add('flex'); } else { $('#two-incomes-toggle').classList.add('hidden'); state.hasTwoIncomes = false; $('#has-two-incomes').checked = false; }
            if (state.status === 'married' && state.hasTwoIncomes) { $('#income2-container').classList.remove('hidden'); } else { $('#income2-container').classList.add('hidden'); }
            if (state.status === 'married') { $('#parent-isole-container').classList.add('hidden'); state.parentIsole = false; $('#parent-isole').checked = false; } else { $('#parent-isole-container').classList.remove('hidden'); }
            if (state.hasPer) { $('#per-details').classList.remove('hidden'); } else { $('#per-details').classList.add('hidden'); }
            if (state.perPlafondUnknown) { $('#per-plafond-container').classList.add('hidden'); } else { $('#per-plafond-container').classList.remove('hidden'); }
            if (state.hasDons) { $('#dons-details').classList.remove('hidden'); } else { $('#dons-details').classList.add('hidden'); }
        }

        function setupEventListeners() {
            $$('input[name="status"]').forEach(r => r.addEventListener('change', (e) => { state.status = e.target.value; updateVisibility(); calculate(); }));
            $('#btn-child-plus').addEventListener('click', () => { if (state.children < 10) { state.children++; $('#child-count').textContent = state.children; calculate(); } });
            $('#btn-child-minus').addEventListener('click', () => { if (state.children > 0) { state.children--; $('#child-count').textContent = state.children; calculate(); } });
            $('#parent-isole').addEventListener('change', (e) => { state.parentIsole = e.target.checked; calculate(); });

            const syncSlider = (input, slider, key, max = 200000) => {
                input.addEventListener('input', (e) => { state[key] = parseInt(e.target.value) || 0; slider.value = Math.min(state[key], max); calculate(); });
                slider.addEventListener('input', (e) => { state[key] = parseInt(e.target.value); input.value = state[key]; calculate(); });
            };
            syncSlider($('#income1-input'), $('#income1-slider'), 'income1');
            syncSlider($('#income2-input'), $('#income2-slider'), 'income2');
            syncSlider($('#per-amount'), $('#per-slider'), 'perAmount', 30000);
            syncSlider($('#dons-66'), $('#dons-66-slider'), 'dons66', 10000);
            syncSlider($('#dons-75'), $('#dons-75-slider'), 'dons75', 2000);

            $('#has-two-incomes').addEventListener('change', (e) => { state.hasTwoIncomes = e.target.checked; updateVisibility(); calculate(); });
            $('#income-foncier').addEventListener('input', (e) => { state.incomeFoncier = parseInt(e.target.value) || 0; calculate(); });
            $('#has-per').addEventListener('change', (e) => { state.hasPer = e.target.checked; updateVisibility(); calculate(); });
            $('#per-plafond').addEventListener('input', (e) => { state.perPlafond = parseInt(e.target.value) || 0; calculate(); });
            $('#per-plafond-unknown').addEventListener('change', (e) => { state.perPlafondUnknown = e.target.checked; updateVisibility(); calculate(); });
            $('#has-dons').addEventListener('change', (e) => { state.hasDons = e.target.checked; updateVisibility(); calculate(); });
            $('#btn-reset').addEventListener('click', () => { window.location.href = window.location.pathname; });
            $('#mobile-results-btn').addEventListener('click', () => { document.querySelector('.lg\\:col-span-5').scrollIntoView({ behavior: 'smooth', block: 'start' }); });
        }

        function init() {
            lucide.createIcons();
            loadFromURL();
            setupEventListeners();
            calculate();
        }

        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
        else init();
    })();
    </script>

</body>
</html>
